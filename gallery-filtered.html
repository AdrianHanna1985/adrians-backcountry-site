
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gallery | Adrian's Backcountry Adventures</title>
  <link rel="stylesheet" href="/assets/css/styles.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.min.css" />
  <style>
    #map { height: 400px; margin: 2em 0; }
    .filters { margin-bottom: 1em; display: flex; gap: 1em; flex-wrap: wrap; }
    .gallery { display: flex; flex-wrap: wrap; gap: 10px; }
    .gallery img { max-width: 200px; height: auto; border-radius: 6px; }
  </style>
</head>
<body>
  <header>
    <nav class="container">
      <ul>
        <li><a href="/index.html">Home</a></li>
        <li><a href="/gallery.html" class="active">Gallery</a></li>
        <li><a href="/calendar.html">Calendar</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <h1>Photo Gallery: Lone Pine & Cottonwood Area 2021</h1>

    <div class="filters">
      <label>
        Filter by Date:
        <select id="dateFilter">
          <option value="">All</option>
          <option value="20210821">20210821</option><option value="20210823">20210823</option><option value="20210824">20210824</option><option value="20210825">20210825</option><option value="20210826">20210826</option><option value="20210828">20210828</option><option value="20210829">20210829</option><option value="20210830">20210830</option><option value="20210901">20210901</option><option value="20211001">20211001</option><option value="20211002">20211002</option>
        </select>
      </label>
      <label>
        Keyword:
        <input type="text" id="keywordFilter" placeholder="Search filename..." />
      </label>
    </div>

    <div id="map"></div>

    <section class="gallery" id="galleryContainer"></section>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox.min.js"></script>
  <script>
    let galleryData = [];

    async function loadGalleryData() {
      const res = await fetch('lone_pine_2021_gallery_data.json');
      galleryData = await res.json();
      renderGallery();
      renderMap();
    }

    function renderGallery(filtered = galleryData) {
      const gallery = document.getElementById('galleryContainer');
      gallery.innerHTML = '';
      filtered.forEach(item => {
        const img = document.createElement('a');
        img.href = item.ImagePath;
        img.setAttribute('data-lightbox', 'adventure');
        img.setAttribute('data-title', `${item.FileName}<br>${item.Date}`);
        img.innerHTML = `<img src="${item.ImagePath}" alt="${item.FileName}" />`;
        gallery.appendChild(img);
      });
    }

    let map;
    let markers = [];

    function renderMap(filtered = galleryData) {
      if (!map) {
        map = L.map('map').setView([36.5, -118.1], 9);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
      }

      // Clear old markers
      markers.forEach(m => map.removeLayer(m));
      markers = [];

      filtered.forEach(item => {
        if (item.Latitude && item.Longitude) {
          const marker = L.marker([item.Latitude, item.Longitude])
            .addTo(map)
            .bindPopup(`<strong>${item.FileName}</strong><br>${item.Date}`);
          markers.push(marker);
        }
      });
    }

    document.getElementById('dateFilter').addEventListener('change', applyFilters);
    document.getElementById('keywordFilter').addEventListener('input', applyFilters);

    function applyFilters() {
      const dateVal = document.getElementById('dateFilter').value;
      const keywordVal = document.getElementById('keywordFilter').value.toLowerCase();
      const filtered = galleryData.filter(item => {
        const matchesDate = !dateVal || item.Date === dateVal;
        const matchesKeyword = !keywordVal || item.FileName.toLowerCase().includes(keywordVal);
        return matchesDate && matchesKeyword;
      });
      renderGallery(filtered);
      renderMap(filtered);
    }

    loadGalleryData();
  </script>
</body>
</html>
